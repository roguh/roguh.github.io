var interpolateFloor,mk_periodic_table,niceFormat,perceivable_inverse,vis=void 0;console.log("Starting animated periodic table."),window.addEventListener("DOMContentLoaded",function(){return(vis=mk_periodic_table()).root(d3.select("div.vis").append("div").classed("periodic_table",!0)),vis(all_chemical_elements),console.log("Started animated periodic table.")}),niceFormat=function(e){return(3<Math.log10(e)?d3.format(",.4s"):d3.format(",.2f"))(e)},interpolateFloor=function(e,t){return e=+e,t=+t,function(n){return Math.floor(e*(1-n)+t*n)}},perceivable_inverse=function(e){var t=d3.hcl(e),n=d3.hcl(e);return"black"===e||"#000"===e||"#000000"===e?"white":isNaN(t.h)?"black":(t.h=360-(180+t.h)-180,t.c=100-t.c,t.l=100-t.l,n=Math.sign(t.l-n.l)*Math.exp(Math.log(100)*(100-Math.abs(t.l-n.l))/100)/2,t.l+=n,t)},mk_periodic_table=function(){var v,y,O,x,C,i=void 0,t=void 0,h=void 0,j=void 0,g=void 0,w=void 0,f=void 0,c={path:null,line:null},u=600,a=Math.round(u*(1+Math.sqrt(5))/2),e=a/19,d=1,s={top:5,left:5},_=d3.behavior.zoom().scaleExtent([.5,10]).center([(s.left+a)/2,(s.top+u)/2]).size([s.left+a,s.top+u]),l=7,m=colorbrewer.YlOrRd[l],o="by_weight",p="by_weight",n={by_weight:{accessor:function(e,t){return t!=null?e.atomicWeight=t:e.atomicWeight}},by_electronegativity:{accessor:function(e,t){return t!=null?e.eneg=t:e.eneg}},by_boiling_point:{accessor:function(e,t){return t!=null?e.boilingPoint=t:e.boilingPoint}},by_melting_point:{accessor:function(e,t){return t!=null?e.meltingPoint=t:e.meltingPoint}},by_abundance:{accessor:function(e,t){return t!=null?e.abundance=t:e.abundance}},by_density:{accessor:function(e,t){return t!=null?e.density=t:e.density}},by_heat:{accessor:function(e,t){return t!=null?e.heat=t:e.heat}}},E=[["Atomic number","atomicNumber"],["Weight (amu)","atomicWeight"],["Boiling point (K)","boilingPoint"],["Melting point (K)","meltingPoint"],["Electronegativity","eneg"],["Abundance (mg/kg)","abundance"]],b=void 0,r=function(e){var t;return o?(t=n[o],e=b(t.classify(t.accessor(e))),null==(e=m[e])?perceivable_inverse(m[l-1]):e):"white"},k=function(e){var t=n[o],e=m.indexOf(e);return e<0?"?":(e=b.invertExtent(e),[t.classify.invert(e[0]),t.classify.invert(e[1])])};return j=d3.tip().attr("class","d3-tip").html(function(e){for(var t,s,o=`<em>${e.name} (${e.sym})</em><table>`,n=0,i=E.length;n<i;n++)[s,t]=E[n],o+=`<tr> <td>${s}:</td> <td>${null!=e[t]?e[t]:"?"}</td> </tr>`;return o+="</table>"}),x=function(){return t.each(function(e){return e.highlighted=!1,v(e,this)})},O=function(e){return v(e,null,function(){return"blue"}),e.highlighted=!0},(vis=function(c){for(var m,g,v,w,O,E,x=0,k=(f=c).length;x<k;x++)for(w in O=f[x],n)null!=(g=(m=n[w]).accessor(O))&&(g=parseFloat(g.replace("[","").replace("]","")),isNaN(g)||(m.accessor(O,g),(null==m.max||m.max<g)&&(m.max=g),(null==m.min||m.min>g)&&(m.min=g)));for(w in n)(m=n[w]).max,m.min,m.classify=d3.scale.linear().clamp(!0).domain([m.min,m.max]).range([0,1]);return o&&(b=d3.scale.quantile().domain([0,1]).range(d3.range(l))),h.selectAll("*").remove(),(i=h.append("svg").attr("width",a+2*s.left).attr("height",u+2*s.top).classed("periodic_table",!0)).append("g").attr("transform",`translate(${s.left}, ${s.top})`),E={6:3,7:3},(t=i.select("g").selectAll("g.element").data(f).enter().append("g")).attr("class",function(e){return`element ${e.sym} ${e.name}`}).each(function(t){var n=d3.select(this);return null!=t.group?(t.x=t.group*e,t.y=t.period*e,3<=t.group&&(t.x+=e),n.classed(`group_${t.group}`,!0)):(t.x=E[t.period]++*e,t.y=(+t.period+3)*e,n.classed("nogroup",!0)),n.classed(`period_${t.period}`,!0)}).attr("transform",function(t){return`translate(${t.x-e/2},${t.y}) scale(${d})`}),v=function(e){return d3.select(this).style("fill",perceivable_inverse(r(e)))},c=function(e){return d3.select(this).style("fill",r(e)).style("stroke",perceivable_inverse(r(e)))},t.append("rect").classed("element_box",!0).attr("height",e).attr("width",e).attr("x",-e/2).attr("y",-e/2).each(c),t.append("text").classed("symbol box_info",!0).attr("y",7).each(v).text(function(e){return e.sym}),t.append("text").classed("box_info",!0).text(function(e){return niceFormat(e.atomicWeight)}).attr("y",21).each(v),t.append("text").classed("box_info",!0).attr("y",-14).attr("x",14).each(v).text(function(e){return e.atomicNumber}),C(),o&&y(),i.call(_),vis.togglezoom(!1),i.call(j),vis.togglehovertips(!0),vis.heightClass(p),vis}).svg=function(){return i},vis.root=function(e){return arguments.length?(h=e,vis):h},vis.classifiers=function(){return n},vis.togglezoom=function(e){return e?_.on("zoom",function(){return d3.event.scale,i.select("g").attr("transform",`translate(${d3.event.translate}) scale(${d3.event.scale})`)}):(_.on("zoom",null),i.select("g").attr("transform",`translate(${s.left}, ${s.top})`))},vis.togglehovertips=function(e){return e?t.on("mouseenter",j.show).on("mouseleave",j.hide):t.on("mouseenter",null).on("mouseleave",null)},v=function(e,t,n){if(!e.highlighted)return n==null&&(n=r),(t=t==null?i.select(`g.${e.sym}`):d3.select(t)).selectAll("path.element_box, rect.element_box").transition().style("fill",n(e)).style("stroke",perceivable_inverse(n(e))),t.selectAll("line.element_box").transition().style("stroke",perceivable_inverse(n(e))),t.selectAll("text.box_info").transition().style("fill",perceivable_inverse(n(e)))},vis.colClass=function(e){return arguments.length?(o=e,w!=null&&w.remove(),o&&(b=d3.scale.quantile().domain([0,1]).range(d3.range(l)),y()),t.each(function(e){return v(e,this)}),vis):o},vis.heightClass=function(s){return arguments.length?((p=s)?(d=.7,t.each(function(t){var s=n[p],s=s.classify(s.accessor(t));if(t._heightOff=s*e*Math.sqrt(2)*(1-d),null==t._heightOff||isNaN(t._heightOff))return t._heightOff=0}).transition().attr("transform",function(t){return`translate(${t._heightOff/2+t.x-e/2}, ${t.y-t._heightOff/2}) scale(${d})`}),null==c.path&&(c.path=t.insert("path",":first-child").style("fill",function(e){return r(e)}).style("stroke",function(e){return perceivable_inverse(r(e))}).attr("class","element_box")),null==c.line&&(c.line=t.insert("line",":nth-child(2)").attr("class","element_box").style("stroke",function(e){return perceivable_inverse(r(e))}).attr("x0",0).attr("y0",0).attr("x1",0).attr("y1",0)),c.path.transition().attr("d",function(t){return`M ${-e/2} ${-e/2} l ${-t._heightOff} ${t._heightOff} l 0 ${e} l ${e} 0 l ${t._heightOff} ${-t._heightOff} z`}),c.line.transition().attr("x1",function(t){return-t._heightOff-e/2}).attr("y1",function(t){return t._heightOff+e/2})):(t.selectAll("path, line").remove(),c={path:null,line:null},d=1,t.transition().attr("transform",function(t){return`translate(${t.x-e/2},${t.y}) scale(${d})`})),vis):p},vis.dimensions=function(e){return arguments.length?(a=e[0],u=e[1],vis):[a,u]},y=function(){n[o];var t=a/(l+1)*3*.43,e=Math.ceil((l+1)/3);return(e=(w=g.append("svg").classed("color_legend",!0).style("display","none").attr("width",e*t).attr("height",90*1.1)).selectAll("g.color").data(m.concat([perceivable_inverse(m[l-1])])).enter().append("g").classed("color",!0).attr("transform",function(e,n){return`translate(${(n-n%3)*t/3}, ${n%3*30})`})).append("rect").classed("element_box",!0).attr("width",24).attr("height",24).style("fill",function(e){return e}).style("stroke",function(e){return perceivable_inverse(e)}),e.append("text").attr("y",15).attr("x",25.5).text(function(e){return e=k(e),"string"==typeof e?`${e}`:`${niceFormat(e[0])} - ${niceFormat(e[1])}`})},C=function(){var e,t,s,o,i,a,r,c,l,d,u;for((o=(g=g??h.insert("div",":first-child").classed("controls",!0)).append("div").classed("main_controls",!0)).append("h1").text("Periodic Table"),i=0,c=(d=[["heightClass","Height"],["colClass","Colors"]]).length;i<c;i++)e=d[i],(s=o.append("p")).classed(`title cell ${e[0]}`,!0).text(`${e[1]}: `),e=e[0],s.append("span").append("select").attr("onchange",`vis.${e}(this.value)`).selectAll("option").data(Object.keys(n).concat([""])).enter().append("option").each(function(t){if(t===vis[e]()||!vis[e]()&&!t)return d3.select(this).attr("selected","selected")}).attr("value",function(e){return e}).text(function(e){return e?e.split("_").join(" "):"none"});for(r=o.append("p"),a=0,l=(u=["zoom","hovertips"]).length;a<l;a++)t=u[a],(s=r.append("span")).append("input").attr("type","checkbox").attr("aria-labelledby",`toggle_${t}`).attr("id",`toggle_${t}_checkbox`).attr("checked","zoom"===t?null:"checked").on("change",function(e){return function(){return vis[`toggle${e}`](d3.select(this).property("checked"))}}(t)),s.append("label").attr("id",`toggle_${t}`).attr("for",`toggle_${t}_checkbox`).text(`Toggle ${t}`);return(s=o.append("p")).append("label").attr("id","search_label").attr("for","search").text("Search by any property"),s.append("input").attr("type","input").attr("aria-labelledby","search_label").attr("id","search").attr("placeholder","Search here").on("input",function(){var e,t,n,s,o,a,i={};if(this.value)for(n=0,a=f.length;n<a;n++)for(t in e=f[n])0<=(""+(o=e[t])).toLowerCase().indexOf(this.value.toLowerCase())&&(i[e.name]=e);for(t in x(),s=[],i)o=i[t],s.push(O(o));return s})},vis}