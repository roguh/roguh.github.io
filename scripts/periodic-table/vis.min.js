var interpolateFloor,mk_periodic_table,niceFormat,perceivable_inverse,vis=void 0;console.log("Starting animated periodic table."),window.addEventListener("DOMContentLoaded",function(){return(vis=mk_periodic_table()).root(d3.select("div.vis").append("div").classed("periodic_table",!0)),vis(all_chemical_elements),console.log("Started animated periodic table.")}),niceFormat=function(e){return(3<Math.log10(e)?d3.format(",.4s"):d3.format(",.2f"))(e)},interpolateFloor=function(e,t){return e=+e,t=+t,function(n){return Math.floor(e*(1-n)+t*n)}},perceivable_inverse=function(t){var e=d3.hcl(t),n=d3.hcl(t);return"black"===t||"#000"===t||"#000000"===t?"white":isNaN(e.h)?"black":(e.h=360-(180+e.h)-180,e.c=100-e.c,e.l=100-e.l,n=Math.sign(e.l-n.l)*Math.exp(Math.log(100)*(100-Math.abs(e.l-n.l))/100)/2,e.l+=n,e)},mk_periodic_table=function(){var p,_,O,C,E,i=void 0,t=void 0,m=void 0,v=void 0,g=void 0,w=void 0,f=void 0,l={path:null,line:null},d=600,r=Math.round(d*(1+Math.sqrt(5))/2),e=r/19,u=1,n={top:5,left:5},y=d3.behavior.zoom().scaleExtent([.5,10]).center([(n.left+r)/2,(n.top+d)/2]).size([n.left+r,n.top+d]),a=7,h=colorbrewer.YlOrRd[a],o="by_weight",j="by_weight",s={by_weight:{accessor:function(e,t){return null!=t?e.atomicWeight=t:e.atomicWeight}},by_electronegativity:{accessor:function(e,t){return null!=t?e.eneg=t:e.eneg}},by_boiling_point:{accessor:function(e,t){return null!=t?e.boilingPoint=t:e.boilingPoint}},by_melting_point:{accessor:function(e,t){return null!=t?e.meltingPoint=t:e.meltingPoint}},by_abundance:{accessor:function(e,t){return null!=t?e.abundance=t:e.abundance}},by_density:{accessor:function(e,t){return null!=t?e.density=t:e.density}},by_heat:{accessor:function(e,t){return null!=t?e.heat=t:e.heat}}},x=[["Atomic number","atomicNumber"],["Weight (amu)","atomicWeight"],["Boiling point (K)","boilingPoint"],["Melting point (K)","meltingPoint"],["Electronegativity","eneg"],["Abundance (mg/kg)","abundance"]],b=void 0,c=function(e){var t;return o?(t=s[o],e=b(t.classify(t.accessor(e))),null==(e=h[e])?perceivable_inverse(h[a-1]):e):"white"},k=function(e){var t=s[o],e=h.indexOf(e);return e<0?"?":(e=b.invertExtent(e),[t.classify.invert(e[0]),t.classify.invert(e[1])])};return v=d3.tip().attr("class","d3-tip").html(function(e){for(var t,s,o=`<em>${e.name} (${e.sym})</em><table>`,n=0,i=x.length;n<i;n++)[s,t]=x[n],o+=`<tr> <td>${s}:</td> <td>${null!=e[t]?e[t]:"?"}</td> </tr>`;return o+="</table>"}),O=function(){return t.each(function(e){return e.highlighted=!1,p(e,this)})},C=function(e){return p(e,null,function(){return"blue"}),e.highlighted=!0},(vis=function(O){for(var l,h,p,g,w,C,x=0,k=(f=O).length;x<k;x++)for(g in w=f[x],s)null!=(h=(l=s[g]).accessor(w))&&(h=parseFloat(h.replace("[","").replace("]","")),isNaN(h)||(l.accessor(w,h),(null==l.max||l.max<h)&&(l.max=h),(null==l.min||l.min>h)&&(l.min=h)));for(g in s)(l=s[g]).max,l.min,l.classify=d3.scale.linear().clamp(!0).domain([l.min,l.max]).range([0,1]);return o&&(b=d3.scale.quantile().domain([0,1]).range(d3.range(a))),m.selectAll("*").remove(),(i=m.append("svg").attr("width",r+2*n.left).attr("height",d+2*n.top).classed("periodic_table",!0)).append("g").attr("transform",`translate(${n.left}, ${n.top})`),C={6:3,7:3},(t=i.select("g").selectAll("g.element").data(f).enter().append("g")).attr("class",function(e){return`element ${e.sym} ${e.name}`}).each(function(t){var n=d3.select(this);return null!=t.group?(t.x=t.group*e,t.y=t.period*e,3<=t.group&&(t.x+=e),n.classed(`group_${t.group}`,!0)):(t.x=C[t.period]++*e,t.y=(+t.period+3)*e,n.classed("nogroup",!0)),n.classed(`period_${t.period}`,!0)}).attr("transform",function(t){return`translate(${t.x-e/2},${t.y}) scale(${u})`}),p=function(e){return d3.select(this).style("fill",perceivable_inverse(c(e)))},O=function(e){return d3.select(this).style("fill",c(e)).style("stroke",perceivable_inverse(c(e)))},t.append("rect").classed("element_box",!0).attr("height",e).attr("width",e).attr("x",-e/2).attr("y",-e/2).each(O),t.append("text").classed("symbol box_info",!0).attr("y",7).each(p).text(function(e){return e.sym}),t.append("text").classed("box_info",!0).text(function(e){return niceFormat(e.atomicWeight)}).attr("y",21).each(p),t.append("text").classed("box_info",!0).attr("y",-14).attr("x",14).each(p).text(function(e){return e.atomicNumber}),E(),o&&_(),i.call(y),vis.togglezoom(!1),i.call(v),vis.togglehovertips(!0),vis.heightClass(j),vis}).svg=function(){return i},vis.root=function(e){return arguments.length?(m=e,vis):m},vis.classifiers=function(){return s},vis.togglezoom=function(e){return e?y.on("zoom",function(){return d3.event.scale,i.select("g").attr("transform",`translate(${d3.event.translate}) scale(${d3.event.scale})`)}):(y.on("zoom",null),i.select("g").attr("transform",`translate(${n.left}, ${n.top})`))},vis.togglehovertips=function(e){return e?t.on("mouseenter",v.show).on("mouseleave",v.hide):t.on("mouseenter",null).on("mouseleave",null)},p=function(e,n,t){if(!e.highlighted)return null==t&&(t=c),(n=null==n?i.select(`g.${e.sym}`):d3.select(n)).selectAll("path.element_box, rect.element_box").transition().style("fill",t(e)).style("stroke",perceivable_inverse(t(e))),n.selectAll("line.element_box").transition().style("stroke",perceivable_inverse(t(e))),n.selectAll("text.box_info").transition().style("fill",perceivable_inverse(t(e)))},vis.colClass=function(e){return arguments.length?(o=e,null!=w&&w.remove(),o&&(b=d3.scale.quantile().domain([0,1]).range(d3.range(a)),_()),t.each(function(e){return p(e,this)}),vis):o},vis.heightClass=function(n){return arguments.length?((j=n)?(u=.7,t.each(function(t){var n=s[j],n=n.classify(n.accessor(t));if(t._heightOff=n*e*Math.sqrt(2)*(1-u),null==t._heightOff||isNaN(t._heightOff))return t._heightOff=0}).transition().attr("transform",function(t){return`translate(${t._heightOff/2+t.x-e/2}, ${t.y-t._heightOff/2}) scale(${u})`}),null==l.path&&(l.path=t.insert("path",":first-child").style("fill",function(e){return c(e)}).style("stroke",function(e){return perceivable_inverse(c(e))}).attr("class","element_box")),null==l.line&&(l.line=t.insert("line",":nth-child(2)").attr("class","element_box").style("stroke",function(e){return perceivable_inverse(c(e))}).attr("x0",0).attr("y0",0).attr("x1",0).attr("y1",0)),l.path.transition().attr("d",function(t){return`M ${-e/2} ${-e/2} l ${-t._heightOff} ${t._heightOff} l 0 ${e} l ${e} 0 l ${t._heightOff} ${-t._heightOff} z`}),l.line.transition().attr("x1",function(t){return-t._heightOff-e/2}).attr("y1",function(t){return t._heightOff+e/2})):(t.selectAll("path, line").remove(),l={path:null,line:null},u=1,t.transition().attr("transform",function(t){return`translate(${t.x-e/2},${t.y}) scale(${u})`})),vis):j},vis.dimensions=function(e){return arguments.length?(r=e[0],d=e[1],vis):[r,d]},_=function(){s[o];var t=r/(a+1)*3*.43,e=Math.ceil((a+1)/3);return(e=(w=g.append("svg").classed("color_legend",!0).style("display","none").attr("width",e*t).attr("height",90*1.1)).selectAll("g.color").data(h.concat([perceivable_inverse(h[a-1])])).enter().append("g").classed("color",!0).attr("transform",function(n,e){return`translate(${(e-e%3)*t/3}, ${e%3*30})`})).append("rect").classed("element_box",!0).attr("width",24).attr("height",24).style("fill",function(e){return e}).style("stroke",function(e){return perceivable_inverse(e)}),e.append("text").attr("y",15).attr("x",25.5).text(function(e){return e=k(e),"string"==typeof e?`${e}`:`${niceFormat(e[0])} - ${niceFormat(e[1])}`})},E=function(){var e,t,n,o,i,a,r,c,l,d,u;for((o=(g=g??m.insert("div",":first-child").classed("controls",!0)).append("div").classed("main_controls",!0)).append("h1").text("Periodic Table"),a=0,c=(d=[["heightClass","Height"],["colClass","Colors"]]).length;a<c;a++)e=d[a],(n=o.append("p")).classed(`title cell ${e[0]}`,!0).text(`${e[1]}: `),e=e[0],n.append("span").append("select").attr("onchange",`vis.${e}(this.value)`).selectAll("option").data(Object.keys(s).concat([""])).enter().append("option").each(function(t){if(t===vis[e]()||!vis[e]()&&!t)return d3.select(this).attr("selected","selected")}).attr("value",function(e){return e}).text(function(e){return e?e.split("_").join(" "):"none"});for(r=o.append("p"),i=0,l=(u=["zoom","hovertips"]).length;i<l;i++)t=u[i],(n=r.append("span")).append("input").attr("type","checkbox").attr("aria-labelledby",`toggle_${t}`).attr("id",`toggle_${t}_checkbox`).attr("checked","zoom"===t?null:"checked").on("change",function(e){return function(){return vis[`toggle${e}`](d3.select(this).property("checked"))}}(t)),n.append("label").attr("id",`toggle_${t}`).attr("for",`toggle_${t}_checkbox`).text(`Toggle ${t}`);return(n=o.append("p")).append("label").attr("id","search_label").attr("for","search").text("Search by any property"),n.append("input").attr("type","input").attr("aria-labelledby","search_label").attr("id","search").attr("placeholder","Search here").on("input",function(){var e,t,n,s,o,a,i={};if(this.value)for(n=0,a=f.length;n<a;n++)for(t in e=f[n])0<=(""+(o=e[t])).toLowerCase().indexOf(this.value.toLowerCase())&&(i[e.name]=e);for(t in O(),s=[],i)o=i[t],s.push(C(o));return s})},vis}