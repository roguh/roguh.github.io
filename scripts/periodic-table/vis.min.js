var interpolateFloor,mk_periodic_table,niceFormat,perceivable_inverse,vis=void 0;console.log("Starting animated periodic table."),window.addEventListener("DOMContentLoaded",function(){return(vis=mk_periodic_table()).root(d3.select("div.vis").append("div").classed("periodic_table",!0)),vis(all_chemical_elements),console.log("Started animated periodic table.")}),niceFormat=function(e){return(3<Math.log10(e)?d3.format(",.4s"):d3.format(",.2f"))(e)},interpolateFloor=function(t,n){return t=+t,n=+n,function(e){return Math.floor(t*(1-e)+n*e)}},perceivable_inverse=function(e){var t=d3.hcl(e),n=d3.hcl(e);return"black"===e||"#000"===e||"#000000"===e?"white":isNaN(t.h)?"black":(t.h=360-(180+t.h)-180,t.c=100-t.c,t.l=100-t.l,n=Math.sign(t.l-n.l)*Math.exp(Math.log(100)*(100-Math.abs(t.l-n.l))/100)/2,t.l+=n,t)},mk_periodic_table=function(){var h,t,c,u,d,f=void 0,p=void 0,g=void 0,v=void 0,m=void 0,r=void 0,b=void 0,n={path:null,line:null},_=600,y=Math.round(_*(1+Math.sqrt(5))/2),x=y/19,$=1,k={top:5,left:5},O=d3.behavior.zoom().scaleExtent([.5,10]).center([(k.left+y)/2,(k.top+_)/2]).size([k.left+y,k.top+_]),w=7,i=colorbrewer.YlOrRd[w],M="by_weight",A="by_weight",z={by_weight:{accessor:function(e,t){return null!=t?e.atomicWeight=t:e.atomicWeight}},by_electronegativity:{accessor:function(e,t){return null!=t?e.eneg=t:e.eneg}},by_boiling_point:{accessor:function(e,t){return null!=t?e.boilingPoint=t:e.boilingPoint}},by_melting_point:{accessor:function(e,t){return null!=t?e.meltingPoint=t:e.meltingPoint}},by_abundance:{accessor:function(e,t){return null!=t?e.abundance=t:e.abundance}},by_density:{accessor:function(e,t){return null!=t?e.density=t:e.density}},by_heat:{accessor:function(e,t){return null!=t?e.heat=t:e.heat}}},a=[["Atomic number","atomicNumber"],["Weight (amu)","atomicWeight"],["Boiling point (K)","boilingPoint"],["Melting point (K)","meltingPoint"],["Electronegativity","eneg"],["Abundance (mg/kg)","abundance"]],C=void 0,F=function(e){var t;return M?(t=z[M],e=C(t.classify(t.accessor(e))),null==(e=i[e])?perceivable_inverse(i[w-1]):e):"white"},l=function(e){var t=z[M],e=i.indexOf(e);return e<0?"?":(e=C.invertExtent(e),[t.classify.invert(e[0]),t.classify.invert(e[1])])};return v=d3.tip().attr("class","d3-tip").html(function(e){for(var t,n,r=`<em>${e.name} (${e.sym})</em><table>`,i=0,l=a.length;i<l;i++)[t,n]=a[i],r+=`<tr> <td>${t}:</td> <td>${null!=e[n]?e[n]:"?"}</td> </tr>`;return r+="</table>"}),h=function(){return p.each(function(e){return e.highlighted=!1,t(e,this)})},d=function(e){return t(e,null,function(){return"blue"}),e.highlighted=!0},(vis=function(e){for(var t,n,r,i,l,a,o=0,s=(b=e).length;o<s;o++)for(r in t=b[o],z)null!=(a=(l=z[r]).accessor(t))&&(a=parseFloat(a.replace("[","").replace("]","")),isNaN(a)||(l.accessor(t,a),(null==l.max||l.max<a)&&(l.max=a),(null==l.min||l.min>a)&&(l.min=a)));for(r in z)(l=z[r]).max,l.min,l.classify=d3.scale.linear().clamp(!0).domain([l.min,l.max]).range([0,1]);return M&&(C=d3.scale.quantile().domain([0,1]).range(d3.range(w))),g.selectAll("*").remove(),(f=g.append("svg").attr("width",y+2*k.left).attr("height",_+2*k.top).classed("periodic_table",!0)).append("g").attr("transform",`translate(${k.left}, ${k.top})`),i={6:3,7:3},(p=f.select("g").selectAll("g.element").data(b).enter().append("g")).attr("class",function(e){return`element ${e.sym} ${e.name}`}).each(function(e){var t=d3.select(this);return null!=e.group?(e.x=e.group*x,e.y=e.period*x,3<=e.group&&(e.x+=x),t.classed(`group_${e.group}`,!0)):(e.x=i[e.period]++*x,e.y=(+e.period+3)*x,t.classed("nogroup",!0)),t.classed(`period_${e.period}`,!0)}).attr("transform",function(e){return`translate(${e.x-x/2},${e.y}) scale(${$})`}),n=function(e){return d3.select(this).style("fill",perceivable_inverse(F(e)))},e=function(e){return d3.select(this).style("fill",F(e)).style("stroke",perceivable_inverse(F(e)))},p.append("rect").classed("element_box",!0).attr("height",x).attr("width",x).attr("x",-x/2).attr("y",-x/2).each(e),p.append("text").classed("symbol box_info",!0).attr("y",7).each(n).text(function(e){return e.sym}),p.append("text").classed("box_info",!0).text(function(e){return niceFormat(e.atomicWeight)}).attr("y",21).each(n),p.append("text").classed("box_info",!0).attr("y",-14).attr("x",14).each(n).text(function(e){return e.atomicNumber}),c(),M&&u(),f.call(O),vis.togglezoom(!1),f.call(v),vis.togglehovertips(!0),vis.heightClass(A),vis}).svg=function(){return f},vis.root=function(e){return arguments.length?(g=e,vis):g},vis.classifiers=function(){return z},vis.togglezoom=function(e){return e?O.on("zoom",function(){return d3.event.scale,f.select("g").attr("transform",`translate(${d3.event.translate}) scale(${d3.event.scale})`)}):(O.on("zoom",null),f.select("g").attr("transform",`translate(${k.left}, ${k.top})`))},vis.togglehovertips=function(e){return e?p.on("mouseenter",v.show).on("mouseleave",v.hide):p.on("mouseenter",null).on("mouseleave",null)},t=function(e,t,n){if(!e.highlighted)return null==n&&(n=F),(t=null==t?f.select(`g.${e.sym}`):d3.select(t)).selectAll("path.element_box, rect.element_box").transition().style("fill",n(e)).style("stroke",perceivable_inverse(n(e))),t.selectAll("line.element_box").transition().style("stroke",perceivable_inverse(n(e))),t.selectAll("text.box_info").transition().style("fill",perceivable_inverse(n(e)))},vis.colClass=function(e){return arguments.length?(M=e,null!=r&&r.remove(),M&&(C=d3.scale.quantile().domain([0,1]).range(d3.range(w)),u()),p.each(function(e){return t(e,this)}),vis):M},vis.heightClass=function(e){return arguments.length?((A=e)?($=.7,p.each(function(e){var t=z[A],t=t.classify(t.accessor(e));if(e._heightOff=t*x*Math.sqrt(2)*(1-$),null==e._heightOff||isNaN(e._heightOff))return e._heightOff=0}).transition().attr("transform",function(e){return`translate(${e._heightOff/2+e.x-x/2}, ${e.y-e._heightOff/2}) scale(${$})`}),null==n.path&&(n.path=p.insert("path",":first-child").style("fill",function(e){return F(e)}).style("stroke",function(e){return perceivable_inverse(F(e))}).attr("class","element_box")),null==n.line&&(n.line=p.insert("line",":nth-child(2)").attr("class","element_box").style("stroke",function(e){return perceivable_inverse(F(e))}).attr("x0",0).attr("y0",0).attr("x1",0).attr("y1",0)),n.path.transition().attr("d",function(e){return`M ${-x/2} ${-x/2} l ${-e._heightOff} ${e._heightOff} l 0 ${x} l ${x} 0 l ${e._heightOff} ${-e._heightOff} z`}),n.line.transition().attr("x1",function(e){return-e._heightOff-x/2}).attr("y1",function(e){return e._heightOff+x/2})):(p.selectAll("path, line").remove(),n={path:null,line:null},$=1,p.transition().attr("transform",function(e){return`translate(${e.x-x/2},${e.y}) scale(${$})`})),vis):A},vis.dimensions=function(e){return arguments.length?(y=e[0],_=e[1],vis):[y,_]},u=function(){z[M];var n=y/(w+1)*3*.43,e=Math.ceil((w+1)/3);return(e=(r=m.append("svg").classed("color_legend",!0).style("display","none").attr("width",e*n).attr("height",90*1.1)).selectAll("g.color").data(i.concat([perceivable_inverse(i[w-1])])).enter().append("g").classed("color",!0).attr("transform",function(e,t){return`translate(${(t-t%3)*n/3}, ${t%3*30})`})).append("rect").classed("element_box",!0).attr("width",24).attr("height",24).style("fill",function(e){return e}).style("stroke",function(e){return perceivable_inverse(e)}),e.append("text").attr("y",15).attr("x",25.5).text(function(e){e=l(e);return"string"==typeof e?`${e}`:`${niceFormat(e[0])} - ${niceFormat(e[1])}`})},c=function(){var t,e,n,r,i,l,a,o,s,c,u;for((r=(m=null==m?g.insert("div",":first-child").classed("controls",!0):m).append("div").classed("main_controls",!0)).append("h1").text("Periodic Table"),i=0,a=(s=[["heightClass","Height"],["colClass","Colors"]]).length;i<a;i++)t=s[i],(n=r.append("p")).classed(`title cell ${t[0]}`,!0).text(`${t[1]}: `),t=t[0],n.append("span").append("select").attr("onchange",`vis.${t}(this.value)`).selectAll("option").data(Object.keys(z).concat([""])).enter().append("option").each(function(e){if(e===vis[t]()||!vis[t]()&&!e)return d3.select(this).attr("selected","selected")}).attr("value",function(e){return e}).text(function(e){return e?e.split("_").join(" "):"none"});for(e=r.append("p"),l=0,o=(c=["zoom","hovertips"]).length;l<o;l++)u=c[l],(n=e.append("span")).append("input").attr("type","checkbox").attr("aria-labelledby",`toggle_${u}`).attr("id",`toggle_${u}_checkbox`).attr("checked","zoom"===u?null:"checked").on("change",function(e){return function(){return vis[`toggle${e}`](d3.select(this).property("checked"))}}(u)),n.append("label").attr("id",`toggle_${u}`).attr("for",`toggle_${u}_checkbox`).text(`Toggle ${u}`);return(n=r.append("p")).append("label").attr("id","search_label").attr("for","search").text("Search by any property"),n.append("input").attr("type","input").attr("aria-labelledby","search_label").attr("id","search").attr("placeholder","Search here").on("input",function(){var e,t,n,r,i,l,a={};if(this.value)for(r=0,n=b.length;r<n;r++)for(t in e=b[r])0<=(""+(l=e[t])).toLowerCase().indexOf(this.value.toLowerCase())&&(a[e.name]=e);for(t in h(),i=[],a)l=a[t],i.push(d(l));return i})},vis};