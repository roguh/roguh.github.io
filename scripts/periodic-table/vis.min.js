var interpolateFloor,mk_periodic_table,niceFormat,perceivable_inverse,vis;vis=void 0,window.addEventListener("DOMReady",function(){return(vis=mk_periodic_table()).root(d3.select("div.vis").append("div").classed("periodic_table",!0)),vis(all_chemical_elements)}),niceFormat=function(e){return Math.log10(e)>3?d3.format(",.4s")(e):d3.format(",.2f")(e)},interpolateFloor=function(e,t){return e=+e,t=+t,function(n){return Math.floor(e*(1-n)+t*n)}},perceivable_inverse=function(e){var t,n,r;return t=d3.hcl(e),r=d3.hcl(e),"black"===e||"#000"===e||"#000000"===e?"white":isNaN(t.h)?"black":(t.h=360-(180+t.h)-180,t.c=100-t.c,t.l=100-t.l,n=Math.sign(t.l-r.l)*Math.exp(Math.log(100)*(100-Math.abs(t.l-r.l))/100)/2,t.l+=n,t)},mk_periodic_table=function(){var e,t,n,r,i,l,a,o,s,c,u,h,d,f,p,g,v,m,b,_,y,x,$,k,O,w,M;return k=void 0,p=void 0,$=void 0,void 0,O=void 0,o=void 0,_=void 0,d=void 0,e={path:null,line:null},g=600,w=Math.round(g*(1+Math.sqrt(5))/2),h=w/19,u=1,y={top:5,left:5},!1,M=d3.behavior.zoom().scaleExtent([.5,10]).center([(y.left+w)/2,(y.top+g)/2]).size([y.left+w,y.top+g]),7,a=colorbrewer.YlOrRd[7],r="by_weight",v="by_weight",t={by_weight:{accessor:function(e,t){return null!=t?e.atomicWeight=t:e.atomicWeight}},by_electronegativity:{accessor:function(e,t){return null!=t?e.eneg=t:e.eneg}},by_boiling_point:{accessor:function(e,t){return null!=t?e.boilingPoint=t:e.boilingPoint}},by_melting_point:{accessor:function(e,t){return null!=t?e.meltingPoint=t:e.meltingPoint}},by_abundance:{accessor:function(e,t){return null!=t?e.abundance=t:e.abundance}},by_density:{accessor:function(e,t){return null!=t?e.density=t:e.density}},by_heat:{accessor:function(e,t){return null!=t?e.heat=t:e.heat}}},x=[["Atomic number","atomicNumber"],["Weight (amu)","atomicWeight"],["Boiling point (K)","boilingPoint"],["Melting point (K)","meltingPoint"],["Electronegativity","eneg"],["Abundance (mg/kg)","abundance"]],f=void 0,i=function(e){var n,i,l;return r?(i=f((n=t[r]).classify(n.accessor(e))),null==(l=a[i])&&(l=perceivable_inverse(a[6])),l):"white"},b=function(e){var n,i,l;return n=t[r],(l=a.indexOf(e))<0?"?":(i=f.invertExtent(l),[n.classify.invert(i[0]),n.classify.invert(i[1])])},O=d3.tip?d3.tip().attr("class","d3-tip").html(function(e){var t,n,r,i,l;for(l=`<em>${e.name} (${e.sym})</em><table>`,t=0,n=x.length;t<n;t++)[r,i]=x[t],l+=`<tr> <td>${r}:</td> <td>${null!=e[i]?e[i]:"?"}</td> </tr>`;return l+="</table>"}):function(){return null},n=function(){return p.each(function(e){return e.highlighted=!1,l(e,this)})},m=function(e){return l(e,null,function(){return"blue"}),e.highlighted=!0},(vis=function(e){var n,l,a,o,m,b,_,x,A;for(o=0,b=(d=e).length;o<b;o++)for(m in n=d[o],t)null!=(A=(x=t[m]).accessor(n))&&(A=parseFloat(A.replace("[","").replace("]","")),isNaN(A)||(x.accessor(n,A),(null==x.max||x.max<A)&&(x.max=A),(null==x.min||x.min>A)&&(x.min=A)));for(m in t)((x=t[m]).max-x.min)/7,x.classify=d3.scale.linear().clamp(!0).domain([x.min,x.max]).range([0,1]);return r&&(f=d3.scale.quantile().domain([0,1]).range(d3.range(7))),$.selectAll("*").remove(),(k=$.append("svg").attr("width",w+2*y.left).attr("height",g+2*y.top).classed("periodic_table",!0)).append("g").attr("transform",`translate(${y.left}, ${y.top})`),_={6:3,7:3},(p=k.select("g").selectAll("g.element").data(d).enter().append("g")).attr("class",function(e){return`element ${e.sym} ${e.name}`}).each(function(e){var t;return t=d3.select(this),null!=e.group?(e.x=e.group*h,e.y=e.period*h,e.group>=3&&(e.x+=h),t.classed(`group_${e.group}`,!0)):(e.x=_[e.period]++*h,e.y=(+e.period+3)*h,t.classed("nogroup",!0)),t.classed(`period_${e.period}`,!0)}).attr("transform",function(e){return`translate(${e.x-h/2},${e.y}) scale(${u})`}),a=function(e){return d3.select(this).style("fill",perceivable_inverse(i(e)))},l=function(e){return d3.select(this).style("fill",i(e)).style("stroke",perceivable_inverse(i(e)))},p.append("rect").classed("element_box",!0).attr("height",h).attr("width",h).attr("x",-h/2).attr("y",-h/2).each(l),p.append("text").classed("symbol box_info",!0).attr("y",7).each(a).text(function(e){return e.sym}),p.append("text").classed("box_info",!0).text(function(e){return niceFormat(e.atomicWeight)}).attr("y",21).each(a),p.append("text").classed("box_info",!0).attr("y",-14).attr("x",14).each(a).text(function(e){return e.atomicNumber}),s(),r&&c(),k.call(M),vis.togglezoom(!1),k.call(O),vis.togglehovertips(!0),vis.heightClass(v),vis}).svg=function(){return k},vis.root=function(e){return arguments.length?($=e,vis):$},vis.classifiers=function(){return t},vis.togglezoom=function(e){return e?M.on("zoom",function(){return!(1===d3.event.scale),k.select("g").attr("transform",`translate(${d3.event.translate}) scale(${d3.event.scale})`)}):(M.on("zoom",null),k.select("g").attr("transform",`translate(${y.left}, ${y.top})`))},vis.togglehovertips=function(e){return e?p.on("mouseenter",O.show).on("mouseleave",O.hide):p.on("mouseenter",null).on("mouseleave",null)},l=function(e,t,n){if(!e.highlighted)return null==n&&(n=i),(t=null==t?k.select(`g.${e.sym}`):d3.select(t)).selectAll("path.element_box, rect.element_box").transition().style("fill",n(e)).style("stroke",perceivable_inverse(n(e))),t.selectAll("line.element_box").transition().style("stroke",perceivable_inverse(n(e))),t.selectAll("text.box_info").transition().style("fill",perceivable_inverse(n(e)))},vis.colClass=function(e){return arguments.length?(r=e,null!=_&&_.remove(),r&&(f=d3.scale.quantile().domain([0,1]).range(d3.range(7)),c()),p.each(function(e){return l(e,this)}),vis):r},vis.heightClass=function(n){return arguments.length?((v=n)?(u=.7,p.each(function(e){var n,r;if(r=(n=t[v]).classify(n.accessor(e)),e._heightOff=r*h*Math.sqrt(2)*(1-u),null==e._heightOff||isNaN(e._heightOff))return e._heightOff=0}).transition().attr("transform",function(e){return`translate(${e._heightOff/2+e.x-h/2}, ${e.y-e._heightOff/2}) scale(${u})`}),null==e.path&&(e.path=p.insert("path",":first-child").style("fill",function(e){return i(e)}).style("stroke",function(e){return perceivable_inverse(i(e))}).attr("class","element_box")),null==e.line&&(e.line=p.insert("line",":nth-child(2)").attr("class","element_box").style("stroke",function(e){return perceivable_inverse(i(e))}).attr("x0",0).attr("y0",0).attr("x1",0).attr("y1",0)),e.path.transition().attr("d",function(e){return`M ${-h/2} ${-h/2} l ${-e._heightOff} ${e._heightOff} l 0 ${h} l ${h} 0 l ${e._heightOff} ${-e._heightOff} z`}),e.line.transition().attr("x1",function(e){return-e._heightOff-h/2}).attr("y1",function(e){return e._heightOff+h/2})):(p.selectAll("path, line").remove(),e={path:null,line:null},u=1,p.transition().attr("transform",function(e){return`translate(${e.x-h/2},${e.y}) scale(${u})`})),vis):v},vis.dimensions=function(e){return arguments.length?(w=e[0],g=e[1],vis):[w,g]},c=function(){var e,n,i;return t[r],30,3,i=w/8*3*.43,e=Math.ceil(8/3),(n=(_=o.append("svg").classed("color_legend",!0).style("display","none").attr("width",e*i).attr("height",90*1.1)).selectAll("g.color").data(a.concat([perceivable_inverse(a[6])])).enter().append("g").classed("color",!0).attr("transform",function(e,t){return`translate(${(t-t%3)*i/3}, ${t%3*30})`})).append("rect").classed("element_box",!0).attr("width",24).attr("height",24).style("fill",function(e){return e}).style("stroke",function(e){return perceivable_inverse(e)}),n.append("text").attr("y",15).attr("x",25.5).text(function(e){var t;return"string"==typeof(t=b(e))?`${t}`:`${niceFormat(t[0])} - ${niceFormat(t[1])}`})},s=function(){var e,r,i,l,a,s,c,u,h,f,p;for(null==o&&(o=$.insert("div",":first-child").classed("controls",!0)),(l=o.append("div").classed("main_controls",!0)).append("h1").text("Periodic Table"),a=0,c=(h=[["heightClass","Height"],["colClass","Colors"]]).length;a<c;a++)e=h[a],(i=l.append("p")).classed(`title cell ${e[0]}`,!0).text(`${e[1]}: `),e=e[0],i.append("span").append("select").attr("onchange",`vis.${e}(this.value)`).selectAll("option").data(Object.keys(t).concat([""])).enter().append("option").each(function(t){if(t===vis[e]()||!vis[e]()&&!t)return d3.select(this).attr("selected","selected")}).attr("value",function(e){return e}).text(function(e){return e?e.split("_").join(" "):"none"});for(r=l.append("p"),s=0,u=(f=["zoom","hovertips"]).length;s<u;s++)p=f[s],(i=r.append("span")).append("input").attr("type","checkbox").attr("aria-labelledby",`toggle_${p}`).attr("id",`toggle_${p}_checkbox`).attr("checked","zoom"===p?null:"checked").on("change",function(e){return function(){return vis[`toggle${e}`](d3.select(this).property("checked"))}}(p)),i.append("label").attr("id",`toggle_${p}`).attr("for",`toggle_${p}_checkbox`).text(`Toggle ${p}`);return(i=l.append("p")).append("label").attr("id","search_label").attr("for","search").text("Search by any property"),i.append("input").attr("type","input").attr("aria-labelledby","search_label").attr("id","search").attr("placeholder","Search here").on("input",function(){var e,t,r,i,l,a,o;if(l={},this.value)for(i=0,r=d.length;i<r;i++)for(t in e=d[i])(""+(o=e[t])).toLowerCase().indexOf(this.value.toLowerCase())>=0&&(l[e.name]=e);for(t in n(),a=[],l)o=l[t],a.push(m(o));return a})},vis};